[fan_generic stepper_fan]
pin: PB5
max_power: 1.0
kick_start_time: 0.5
off_below: 0.10


[gcode_macro STEPPER_FAN_ON]
description: turn stepper fan on
gcode:
  {% set percent = params.PERCENT | default(100, True) | int %}
  SET_FAN_SPEED FAN=stepper_fan SPEED={percent/100 | float}
  SET_GCODE_VARIABLE MACRO=RESTORE_STEPPER_FAN VARIABLE=speed VALUE={percent}
  M118 stepper fan set to {percent}%


[gcode_macro STEPPER_FAN_OFF]
description: turn on exhaust fan
gcode:
  SET_FAN_SPEED FAN=stepper_fan SPEED=0
  M118 stepper fan off


[gcode_macro RESTORE_STEPPER_FAN]
description: restore last known stepper fan speed
variable_speed: 100
gcode:
  STEPPER_FAN_ON PERCENT={printer['gcode_macro RESTORE_STEPPER_FAN']['speed']}
