[gcode_macro ENABLE_FILAMENT_SENSOR]
description: enable ercf filament encoder
variable_skip: False
gcode:

  {% if printer.ercf.clog_detection|int == 1 %}
    M118 enabling ercf filament encoder...
    SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=1
  {% endif %}

  FILAMENT_SENSOR_STATUS


[gcode_macro DISABLE_FILAMENT_SENSOR]
description: disable ercf filament encoder
gcode:
  
  M118 disabling ercf filament encoder...
  SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=0

  FILAMENT_SENSOR_STATUS


[gcode_macro FILAMENT_SENSOR_STATUS]
description: ercf sensor status
gcode:
  ENCODER_SENSOR_STATUS
  TOOLHEAD_SENSOR_STATUS


[gcode_macro ENCODER_SENSOR_STATUS]
description: ercf sensor status
gcode:
  {% set sensor = printer['filament_motion_sensor encoder_sensor'] %}
  {% if sensor %}
    M118 { "ercf filament encoder enabled: %s, filament: %s" % (sensor.enabled, sensor.filament_detected) }
  {% else %}
    M118 ercf filament encoder not found?
  {% endif %}


[gcode_macro SKIP_FILAMENT_SENSOR]
description: no-op
gcode:
  M118 SKIP_FILAMENT_SENSOR no-op
