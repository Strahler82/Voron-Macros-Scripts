[gcode_macro ERCF_CALIBRATE_TOOL]
gcode:
  {% set tool = params.TOOL | default(8,True) | int %}
  M118 calibrating tool T{tool}...
  M104 S245
  ERCF_HOME
  CENTER
  ERCF_GOTO_LOAD_POSITION
  M109 S245
  _ERCF_CALIBRATE_SINGLE TOOL={tool}
  ERCF_HOME
  _ERCF_SELECT_TOOL TOOL={tool}
  ERCF_CALIBRATE_ENCODER RANGE=2
  ERCF_EJECT
  ERCF_HOME
  CENTER
  ERCF_GOTO_LOAD_POSITION
  SKIP_ERCF_PAUSE
  T{tool}
  ERCF_EJECT
  SKIP_ERCF_PAUSE SKIP=False


[gcode_macro ERCF_CALIBRATE_BLOCK]
gcode:
  {% set tool = params.TOOL | default(8,True) | int %}
  M118 calibrating block T{tool}...
  ERCF_HOME
  _ERCF_SELECT_TOOL TOOL=8
  _ERCF_SELECT_TOOL TOOL={tool}
  SKIP_ERCF_PAUSE
  ERCF_LOAD
  _ERCF_SERVO_UP
  _ERCF_MOTORS_OFF
  SKIP_ERCF_PAUSE SKIP=False
  SET_GCODE_VARIABLE MACRO=ERCF_CALIBRATE_BLOCK_END VARIABLE=tool VALUE={tool}
  M118 now run ERCF_CALIBRATE_BLOCK_END


[gcode_macro ERCF_CALIBRATE_BLOCK_END]
variable_tool: 8
gcode:
  {% set tool = params.TOOL | default(printer['gcode_macro ERCF_CALIBRATE_BLOCK_END']['tool']) | int %}
  _ERCF_CALIB_SELECTOR TOOL={tool}
  ERCF_HOME
