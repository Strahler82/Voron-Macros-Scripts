[gcode_macro HOME]
gcode:
  G28
  G90


[gcode_macro CHECK_HOMED]
description: home only if not already homed
gcode:
  {% if "xyz" not in printer.toolhead.homed_axes %}
    HOME
  {% endif %}


[gcode_macro PARK]
description: z hop safe distance and park toolhead at rear
gcode:
  {% set x = params.X|default(printer.toolhead.axis_maximum.x)|float %}
  {% set y = params.Y|default(printer.toolhead.axis_maximum.y)|float %}
  {% set x_park = x/2 %}
  {% set y_park = (y - 5.0)|abs %}
  {% set max_z = printer.toolhead.axis_maximum.z|float %}
  {% set act_z = printer.toolhead.position.z|float %}
  {% if act_z < (max_z - 2.0) %}
      {% set z_safe = 2.0 %}
  {% else %}
      {% set z_safe = max_z - act_z %}
  {% endif %}
  { action_respond_info("parking to X:%f Y:%f, z-hop %f" % (x_park, y_park, z_safe)) }
  G91
  G1 Z{z_safe} F900
  G90
  G1 X{x_park} Y{y_park} F6000


[gcode_macro PARK_FRONT]
description: z hop safe distance and park toolhead at front
gcode:
  PARK Y=0


[gcode_macro BRUSH]
description: brush nozzle
gcode:
  CHECK_HOMED
  {% if printer.extruder.temperature >= printer.configfile.settings.extruder.min_extrude_temp %}
    SAVE_GCODE_STATE NAME=__brush
    M83
    G1 E-1 F2400
    RESTORE_GCODE_STATE NAME=__brush
  {% endif %}
  G90
  {% for i in range(params.TIMES | default(3) | int) %}
    G1 X76 Y350 Z5 F3000;   left
    G1 X130 Y350 Z5 F3000; right
  {% endfor %}


[gcode_macro CENTER]
description: center toolhead on bed
gcode:
  CHECK_HOMED
  G90
  G0 X175 Y175 Z30 F20000


[gcode_macro RAISE]
description: raise toolhead high and front, for working on gantry
gcode:
  CHECK_HOMED
  G90
  G0 X175 Y0 Z250 F20000
