[gcode_macro PREHEAT_ABS]
gcode:
  EXHAUST_FAN_ON
  M140 S110
  SET_HEATER_TEMPERATURE HEATER=extruder TARGET=245
  STATUS_PREHEAT


[gcode_macro PREHEAT_PCCF]
gcode:
  EXHAUST_FAN_ON
  M140 S110
  SET_HEATER_TEMPERATURE HEATER=extruder TARGET=290
  STATUS_PREHEAT


[gcode_macro PREHEAT_PETG]
gcode:
  EXHAUST_FAN_ON
  M140 S80
  SET_HEATER_TEMPERATURE HEATER=extruder TARGET=245
  STATUS_PREHEAT


[gcode_macro PREHEAT_PLA]
gcode:
  EXHAUST_FAN_ON
  M140 S60
  SET_HEATER_TEMPERATURE HEATER=extruder TARGET=210
  STATUS_PREHEAT


[gcode_macro PREHEAT_TPU]
gcode:
  EXHAUST_FAN_ON
  M140 S40
  SET_HEATER_TEMPERATURE HEATER=extruder TARGET=245
  STATUS_PREHEAT


[gcode_macro CONVECTION_START]
gcode:
  CHECK_HOMED
  DOCK_PROBE
  CENTER
  G1 Z10
  M106 S255


[gcode_macro COOLDOWN]
description: turn off all fans and heaters
variable_skip: False
gcode:
  {% if skip %}
    M118 skipping COOLDOWN
    SKIP_COOLDOWN SKIP=False
  {% else %}
    TURN_OFF_HEATERS
    M107
    SET_EXHAUST_FAN_TIMER
  {% endif %}


[gcode_macro SOAK]
description: PREHEAT_ABS, turn on exhaust fan, set timeouts to 1 hour
gcode:
  M140 S110
  EXHAUST_FAN_ON
  CHECK_HOMED
  DOCK_PROBE
  SET_EXHAUST_FAN_TIMER MINUTES=60
  SET_IDLE_TIMEOUT TIMEOUT={ 60 * 60 }
  STATUS_PREHEAT


[gcode_macro CHAMBER_WAIT]
description: wait for chamber to reach temp
variable_skip: False
gcode:

  {% if skip %}
    M118 skipping CHAMBER_WAIT
    SKIP_CHAMBER_WAIT SKIP=False
  {% else %}
    M118 waiting for chamber to warm up...
    TEMPERATURE_WAIT SENSOR="temperature_sensor chamber" MINIMUM=40
  {% endif %}



[gcode_macro SKIP_CHAMBER_WAIT]
description: skip waiting on chamber temperature next run
gcode:
  {% set skip = params.SKIP|default(True, True)|int %}

  SET_GCODE_VARIABLE MACRO=CHAMBER_WAIT VARIABLE=skip VALUE={skip}

  M118 { 'SKIP_CHAMBER_WAIT = %d' % (skip) }


[gcode_macro SKIP_COOLDOWN]
description: skip cooldown
gcode:
  {% set skip = params.SKIP|default(True, True)|int %}

  SET_GCODE_VARIABLE MACRO=COOLDOWN VARIABLE=skip VALUE={skip}

  M118 { 'SKIP_COOLDOWN = %d' % (skip) }
